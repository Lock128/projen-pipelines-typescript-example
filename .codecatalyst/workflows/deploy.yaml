# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

Name: deploy
SchemaVersion: "1.0"
Triggers:
  - Type: PUSH
    Branches:
      - main
Actions:
  Synth CDK application:
    Identifier: aws/build-beta@v1
    Inputs:
      Sources:
        - WorkflowSource
      Variables:
        - Name: CI
          Value: "true"
    Outputs:
      AutoDiscoverReports:
        Enabled: false
    Configuration:
      Steps:
        - Run: npx projen install:ci
        - Run: npx projen build
  Publish assets to AWS:
    Identifier: aws/build-beta@v1
    Inputs:
      Sources:
        - WorkflowSource
      Variables:
        - Name: CI
          Value: "true"
    Outputs:
      AutoDiscoverReports:
        Enabled: false
    Configuration:
      Steps:
        - Run: npx projen install:ci
        - Run: npx projen publish:assets
        - Run: npx projen bump
        - Run: npx projen release:push-assembly
    DependsOn:
      - Synth CDK application
  deploy_dev:
    Identifier: aws/build-beta@v1
    Inputs:
      Sources:
        - WorkflowSource
      Variables:
        - Name: CI
          Value: "true"
    Outputs:
      AutoDiscoverReports:
        Enabled: false
    Configuration:
      Steps:
        - Run: npx projen install:ci
        - Run: npx projen deploy:dev
    DependsOn:
      - Publish assets to AWS
  deploy_preprod:
    Identifier: aws/build-beta@v1
    Inputs:
      Sources:
        - WorkflowSource
      Variables:
        - Name: CI
          Value: "true"
    Outputs:
      AutoDiscoverReports:
        Enabled: false
    Configuration:
      Steps:
        - Run: npx projen install:ci
        - Run: npx projen deploy:preprod
    DependsOn:
      - Publish assets to AWS
      - deploy-dev
